var Propeller;!function(t){var e={angle:0,speed:0,inertia:0,minimalSpeed:.001,minimalAngleChange:.1,step:0,stepTransitionTime:0,stepTransitionEasing:"linear",rotateParentInstantly:!1,touchElement:null};(Propeller=function(t,e){if("string"==typeof t&&(t=document.querySelectorAll(t)),t.length>1)return Propeller.createMany(t,e);1===t.length&&(t=t[0]),this.element=t,this.active=!1,this.transiting=!1,this.update=this.update.bind(this),this.initCSSPrefix(),this.initAngleGetterSetter(),this.initOptions(e),this.initHardwareAcceleration(),this.initTransition(),this.bindHandlers(),this.addListeners(),this.update()}).createMany=function(t,e){for(var i=[],n=0;n<t.length;n++)i.push(new Propeller(t[n],e));return i};var i=Propeller.prototype;i.initAngleGetterSetter=function(){Object.defineProperty(this,"angle",{get:function(){return this._angle},set:function(t){this._angle=t,this.virtualAngle=t,this.updateCSS()}})},i.bindHandlers=function(){this.onRotationStart=this.onRotationStart.bind(this),this.onRotationStop=this.onRotationStop.bind(this),this.onRotated=this.onRotated.bind(this)},i.addListeners=function(){this.listenersInstalled=!0,"ontouchstart"in document.documentElement?(this.touchElement.addEventListener("touchstart",this.onRotationStart),this.touchElement.addEventListener("touchmove",this.onRotated),this.touchElement.addEventListener("touchend",this.onRotationStop),this.touchElement.addEventListener("touchcancel",this.onRotationStop),this.touchElement.addEventListener("dragstart",this.returnFalse)):(this.touchElement.addEventListener("mousedown",this.onRotationStart),this.touchElement.addEventListener("mousemove",this.onRotated),this.touchElement.addEventListener("mouseup",this.onRotationStop),this.touchElement.addEventListener("mouseleave",this.onRotationStop),this.touchElement.addEventListener("dragstart",this.returnFalse)),this.touchElement.ondragstart=this.returnFalse},i.removeListeners=function(){this.listenersInstalled=!1,"ontouchstart"in document.documentElement?(this.touchElement.removeEventListener("touchstart",this.onRotationStart),this.touchElement.removeEventListener("touchmove",this.onRotated),this.touchElement.removeEventListener("touchend",this.onRotationStop),this.touchElement.removeEventListener("touchcancel",this.onRotationStop),this.touchElement.removeEventListener("dragstart",this.returnFalse)):(this.touchElement.removeEventListener("mousedown",this.onRotationStart),this.touchElement.removeEventListener("mousemove",this.onRotated),this.touchElement.removeEventListener("mouseup",this.onRotationStop),this.touchElement.removeEventListener("mouseleave",this.onRotationStop),this.touchElement.removeEventListener("dragstart",this.returnFalse))},i.bind=function(){!0!==this.listenersInstalled&&this.addListeners()},i.unbind=function(){!0===this.listenersInstalled&&(this.removeListeners(),this.onRotationStop())},i.stop=function(){this.speed=0,this.onRotationStop()},i.onRotationStart=function(t){this.initDrag(),this.active=!0,void 0!==this.onDragStart&&this.onDragStart(),!1===this.rotateParentInstantly&&t.stopPropagation()},i.onRotationStop=function(){void 0!==this.onDragStop&&!0===this.active&&this.onDragStop(),this.active=!1},i.onRotated=function(t){!0===this.active&&(t.stopPropagation(),t.preventDefault(),void 0!==t.targetTouches&&void 0!==t.targetTouches[0]?this.lastMouseEvent={x:t.targetTouches[0].clientX,y:t.targetTouches[0].clientY}:this.lastMouseEvent={x:t.clientX,y:t.clientY})},i.update=function(){void 0!==this.lastMouseEvent&&!0===this.active&&this.updateAngleToMouse(this.lastMouseEvent),this.updateAngle(),this.applySpeed(),this.applyInertia(),Math.abs(this.lastAppliedAngle-this._angle)>=this.minimalAngleChange&&!1===this.transiting&&(this.updateCSS(),this.blockTransition(),void 0!==this.onRotate&&"function"==typeof this.onRotate&&this.onRotate.bind(this)(),this.lastAppliedAngle=this._angle),window.requestAnimFrame(this.update)},i.updateAngle=function(){this.step>0?this._angle=this.getAngleFromVirtual():this._angle=this.normalizeAngle(this.virtualAngle)},i.getAngleFromVirtual=function(){return Math.ceil(this.virtualAngle/this.step)*this.step},i.normalizeAngle=function(t){var e=t;return(e%=360)<0&&(e=360+e),e},i.differenceBetweenAngles=function(t,e){var i=t*(Math.PI/180),n=e*(Math.PI/180),s=Math.atan2(Math.sin(i-n),Math.cos(i-n))*(180/Math.PI);return Math.round(100*s)/100},i.applySpeed=function(){this.inertia>0&&0!==this.speed&&!1===this.active&&(this.virtualAngle+=this.speed)},i.applyInertia=function(){this.inertia>0&&(Math.abs(this.speed)>=this.minimalSpeed?(this.speed=this.speed*this.inertia,!1===this.active&&Math.abs(this.speed)<this.minimalSpeed&&void 0!==this.onStop&&this.onStop()):0!==this.speed&&(this.speed=0))},i.updateAngleToMouse=function(t){var i=this.element.getBoundingClientRect(),n=i.left+i.width/2,s=i.top+i.height/2,o=(Math.atan2(t.y-s,t.x-n)+Math.PI)*Propeller.radToDegMulti;if(void 0===this.lastMouseAngle&&(this.lastElementAngle=this.virtualAngle,this.lastMouseAngle=o),this.stepTransitionTime!==e.stepTransitionTime)this.speed=this.mouseDiff=this.differenceBetweenAngles(o,this.lastMouseAngle),this.virtualAngle=this.lastElementAngle+this.mouseDiff,this.lastElementAngle=this.virtualAngle,this.lastMouseAngle=o;else{var a=this.virtualAngle;this.mouseDiff=o-this.lastMouseAngle,this.virtualAngle=this.lastElementAngle+this.mouseDiff;var r=this.virtualAngle;this.speed=this.differenceBetweenAngles(r,a)}},i.initDrag=function(){this.speed=0,this.lastMouseAngle=void 0,this.lastElementAngle=void 0,this.lastMouseEvent=void 0},i.initOptions=function(t){t=t||e,this.touchElement=document.querySelectorAll(t.touchElement)[0]||this.element,this.onRotate=t.onRotate||t.onrotate,this.onStop=t.onStop||t.onstop,this.onDragStop=t.onDragStop||t.ondragstop,this.onDragStart=t.onDragStart||t.ondragstart,this.step=t.step||e.step,this.stepTransitionTime=t.stepTransitionTime||e.stepTransitionTime,this.stepTransitionEasing=t.stepTransitionEasing||e.stepTransitionEasing,this.angle=t.angle||e.angle,this.speed=t.speed||e.speed,this.inertia=t.inertia||e.inertia,this.minimalSpeed=t.minimalSpeed||e.minimalSpeed,this.lastAppliedAngle=this.virtualAngle=this._angle=t.angle||e.angle,this.minimalAngleChange=this.step!==e.step?this.step:e.minimalAngleChange,this.rotateParentInstantly=t.rotateParentInstantly||e.rotateParentInstantly},i.initCSSPrefix=function(){void 0===Propeller.cssPrefix&&(void 0!==document.body.style.transform?Propeller.cssPrefix="":void 0!==document.body.style.mozTransform?Propeller.cssPrefix="-moz-":void 0!==document.body.style.webkitTransform?Propeller.cssPrefix="-webkit-":void 0!==document.body.style.msTransform&&(Propeller.cssPrefix="-ms-"))},i.initHardwareAcceleration=function(){this.accelerationPostfix="";var t,e=document.createElement("p"),i={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(var n in document.body.insertBefore(e,null),i)void 0!==e.style[n]&&(e.style[n]="translate3d(1px,1px,1px)",t=window.getComputedStyle(e).getPropertyValue(i[n]));document.body.removeChild(e),!0===(void 0!==t&&t.length>0&&"none"!==t)&&(this.accelerationPostfix="translateZ(0)",this.element.style[Propeller.cssPrefix+"transform"]=this.accelerationPostfix,this.updateCSS())},i.initTransition=function(){if(this.stepTransitionTime!==e.stepTransitionTime){var t="all "+this.stepTransitionTime+"ms "+this.stepTransitionEasing;this.element.style[Propeller.cssPrefix+"transition"]=t}},i.updateCSS=function(){this.element.style[Propeller.cssPrefix+"transform"]="rotate("+this._angle+"deg) "+this.accelerationPostfix},i.blockTransition=function(){if(this.stepTransitionTime!==e.stepTransitionTime){var t=this;setTimeout(function(){t.transiting=!1},this.stepTransitionTime),this.transiting=!0}},i.returnFalse=function(){return!1},void 0!==t.$&&($.propeller={},$.propeller.propellers=[],$.fn.propeller=function(t){return this.each(function(){if(!$.data(this,"plugin_propeller")){var e=new Propeller(this,t);$.data(this,"plugin_propeller",e),$.propeller.propellers.push(e)}})}),Propeller.deg2radians=2*Math.PI/360,Propeller.radToDegMulti=57.29577951308232,t.Propeller=Propeller}(window),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)};module.exports = Propeller;
